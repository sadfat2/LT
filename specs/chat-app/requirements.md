# 聊天室应用需求文档

## 介绍

开发一款基于 H5 的即时通讯聊天室应用，使用 UniApp 框架开发前端，采用 Socket.io 实现实时通讯。应用支持一对一私聊，用户可以发送文本、图片、语音消息。UI 设计采用微信风格，绿色主题，简洁现代。

## 技术框架

- **前端**: UniApp (Vue3 + TypeScript) + @hyoga/uni-socket.io
- **后端**: Node.js + Socket.io 4.x
- **UI 风格**: 微信风格，绿色主题 (#07C160)

---

## 需求

### 需求 1 - 用户注册

**用户故事：** 作为新用户，我希望能够注册一个账号，以便使用聊天室的各项功能。

#### 验收标准

1. When 用户在注册页面输入账号、密码和确认密码，the 系统 shall 验证账号格式（4-20位字母数字）和密码强度（6-20位，包含字母和数字）。
2. When 用户提交注册信息且验证通过，the 系统 shall 创建新用户账号并自动登录跳转至消息列表页。
3. When 账号已被注册，the 系统 shall 提示"该账号已被使用"。
4. When 两次密码输入不一致，the 系统 shall 提示"两次密码输入不一致"。

---

### 需求 2 - 用户登录

**用户故事：** 作为已注册用户，我希望能够登录我的账号，以便查看消息和与好友聊天。

#### 验收标准

1. When 用户输入正确的账号和密码点击登录，the 系统 shall 验证凭据并跳转至消息列表页。
2. When 用户输入错误的账号或密码，the 系统 shall 提示"账号或密码错误"。
3. When 用户登录成功，the 系统 shall 保存登录状态（Token），下次打开应用自动登录。
4. When 用户点击"退出登录"，the 系统 shall 清除登录状态并跳转至登录页。

---

### 需求 3 - 消息列表

**用户故事：** 作为用户，我希望能够查看所有聊天会话列表，以便快速找到并进入聊天。

#### 验收标准

1. When 用户进入消息列表页，the 系统 shall 按最后消息时间倒序显示所有会话。
2. When 会话有未读消息，the 系统 shall 在会话项上显示未读消息数量红点。
3. When 用户点击某个会话，the 系统 shall 跳转至该会话的聊天详情页。
4. When 用户收到新消息，the 系统 shall 实时更新会话列表（无需手动刷新）。
5. When 用户左滑会话项，the 系统 shall 显示"删除"操作按钮。

---

### 需求 4 - 聊天功能（文本消息）

**用户故事：** 作为用户，我希望能够与好友发送和接收文本消息，进行实时对话。

#### 验收标准

1. When 用户在输入框输入文本并点击发送，the 系统 shall 通过 Socket.io 发送消息并在聊天界面显示。
2. When 收到对方的新消息，the 系统 shall 实时显示在聊天界面并播放提示音。
3. When 消息发送成功，the 系统 shall 在消息旁显示"已发送"状态。
4. When 对方已读消息，the 系统 shall 将状态更新为"已读"。
5. While 用户离线时，when 有新消息发送给用户，the 系统 shall 缓存离线消息并在用户上线后推送。

---

### 需求 5 - 聊天功能（图片消息）

**用户故事：** 作为用户，我希望能够发送图片给好友，分享生活中的精彩时刻。

#### 验收标准

1. When 用户点击"+"按钮并选择"相册"，the 系统 shall 打开系统相册供用户选择图片。
2. When 用户点击"+"按钮并选择"拍照"，the 系统 shall 打开相机供用户拍摄照片。
3. When 用户选择/拍摄图片确认后，the 系统 shall 压缩图片并上传，发送成功后显示在聊天界面。
4. When 用户点击聊天中的图片，the 系统 shall 全屏预览图片，支持缩放和保存。

---

### 需求 6 - 聊天功能（语音消息）

**用户故事：** 作为用户，我希望能够发送语音消息，在不方便打字时也能快速沟通。

#### 验收标准

1. When 用户按住语音按钮，the 系统 shall 开始录音并显示录音波形动画和时长。
2. When 用户松开语音按钮，the 系统 shall 停止录音、上传音频文件并发送语音消息。
3. When 用户按住后上滑松开，the 系统 shall 取消本次录音。
4. When 录音时长少于1秒，the 系统 shall 提示"录音时间太短"并取消发送。
5. When 录音时长超过60秒，the 系统 shall 自动停止录音并发送。
6. When 用户点击语音消息，the 系统 shall 播放语音并显示播放进度动画。

---

### 需求 7 - 消息撤回

**用户故事：** 作为用户，我希望能够撤回已发送的消息，以便纠正错误或收回不当内容。

#### 验收标准

1. When 用户长按自己发送的消息（2分钟内），the 系统 shall 显示包含"撤回"选项的操作菜单。
2. When 用户点击"撤回"，the 系统 shall 删除该消息并在聊天界面显示"你撤回了一条消息"。
3. When 消息被撤回，the 系统 shall 同步更新对方的聊天界面，显示"对方撤回了一条消息"。
4. When 消息发送超过2分钟，the 系统 shall 不显示撤回选项。

---

### 需求 8 - 通讯录

**用户故事：** 作为用户，我希望能够查看我的所有好友，方便发起聊天。

#### 验收标准

1. When 用户进入通讯录页面，the 系统 shall 按字母顺序显示所有好友列表。
2. When 用户点击右侧字母索引，the 系统 shall 快速跳转到对应字母分组。
3. When 用户点击某个好友，the 系统 shall 跳转至该好友的聊天页面。
4. When 用户点击好友头像，the 系统 shall 显示好友的个人资料页。

---

### 需求 9 - 添加好友

**用户故事：** 作为用户，我希望能够通过搜索账号添加新好友，扩展我的社交圈。

#### 验收标准

1. When 用户在搜索框输入账号/用户ID，the 系统 shall 搜索并显示匹配的用户列表。
2. When 用户点击"添加"按钮，the 系统 shall 发送好友申请给对方。
3. When 用户收到好友申请，the 系统 shall 在通讯录页面显示新朋友提醒红点。
4. When 用户进入"新的朋友"页面，the 系统 shall 显示待处理的好友申请列表。
5. When 用户点击"同意"，the 系统 shall 添加双方为好友关系。
6. When 用户点击"拒绝"，the 系统 shall 删除该好友申请。

---

### 需求 10 - 个人中心

**用户故事：** 作为用户，我希望能够查看和编辑我的个人信息。

#### 验收标准

1. When 用户进入个人中心页面，the 系统 shall 显示用户头像、昵称、账号ID和个性签名。
2. When 用户点击头像，the 系统 shall 允许从相册选择或拍摄新头像并上传。
3. When 用户点击昵称，the 系统 shall 弹出编辑框允许修改昵称（限制20字符）。
4. When 用户点击个性签名，the 系统 shall 弹出编辑框允许修改签名（限制50字符）。
5. When 用户修改信息后点击保存，the 系统 shall 更新用户资料并同步到服务器。
6. When 用户点击"退出登录"，the 系统 shall 清除本地登录状态并跳转至登录页。

---

## UI 设计规范

### 配色方案

| 用途 | 颜色值 | 说明 |
|------|--------|------|
| 主色调 | #07C160 | 微信绿，用于按钮、链接、强调元素 |
| 背景色 | #EDEDED | 页面背景 |
| 会话背景 | #F7F7F7 | 聊天页面背景 |
| 白色卡片 | #FFFFFF | 列表项、消息气泡背景 |
| 主文字 | #191919 | 主要文字颜色 |
| 次要文字 | #999999 | 辅助说明文字 |
| 分割线 | #E5E5E5 | 列表分割线 |
| 我的气泡 | #95EC69 | 自己发送的消息气泡 |
| 对方气泡 | #FFFFFF | 对方发送的消息气泡 |

### 设计规范

- **圆角**：头像使用圆形，按钮圆角 4px，消息气泡圆角 8px
- **间距**：列表项上下内边距 12px，左右内边距 16px
- **字号**：标题 18px，正文 16px，辅助文字 14px
- **底部导航**：消息、通讯录、我的（三个 Tab）

### 页面结构

```
├── 登录页 (login)
├── 注册页 (register)
├── 主页 (TabBar)
│   ├── 消息列表 (message)
│   ├── 通讯录 (contacts)
│   └── 我的 (profile)
├── 聊天详情页 (chat)
├── 添加好友页 (add-friend)
├── 新的朋友页 (new-friends)
├── 好友资料页 (user-profile)
└── 个人信息编辑页 (edit-profile)
```
